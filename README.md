# VmesteTrenim Bot üèãÔ∏è

Telegram-–±–æ—Ç –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å–æ–≤–º–µ—Å—Ç–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫. –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è—Ç—å—Å—è –∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏—é –¥–ª—è –∑–∞–Ω—è—Ç–∏–π —Å–ø–æ—Ä—Ç–æ–º.

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
vmesteTrenimBot/
‚îú‚îÄ‚îÄ backend/          # FastAPI backend (REST API)
‚îú‚îÄ‚îÄ bot/              # Telegram –±–æ—Ç (pyTelegramBotAPI)
‚îú‚îÄ‚îÄ deployment/       # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ docs/             # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Backend**: FastAPI, SQLAlchemy, Alembic, Pydantic, SQLAdmin
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL (Docker), SQLite (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
- **Bot**: pyTelegramBotAPI, httpx
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: Loguru
- **–õ–∏–Ω—Ç–∏–Ω–≥**: Ruff (lint + format)
- **Pre-commit**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
- **–î–µ–ø–ª–æ–π**: Docker, Docker Compose

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.13+
- [uv](https://github.com/astral-sh/uv) ‚Äî –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤
- Docker & Docker Compose (–¥–ª—è –¥–µ–ø–ª–æ—è)

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

**1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**

```bash
git clone <repo-url>
cd vmesteTrenimBot
```

**2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Backend:**

```bash
cd backend

# –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª
cat > .env << EOF
DATABASE_URL=sqlite+aiosqlite:///./app.db
DEBUG=true
API_HOST=0.0.0.0
API_PORT=8000
EOF

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ
uv sync
uv run uvicorn main:app --reload
```

Backend –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://localhost:8000
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

**3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Telegram –±–æ—Ç–∞:**

```bash
cd bot

# –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª (–∑–∞–º–µ–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –Ω–∞ —Å–≤–æ–π)
cat > .env << EOF
BOT_TOKEN=your_telegram_bot_token_here
API_BASE_URL=http://localhost:8000/api/v1
DEBUG=true
EOF

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ
uv sync
uv run python main.py
```

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose

```bash
cd deployment

# –°–æ–∑–¥–∞–π—Ç–µ .env —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
cat > .env << EOF
BOT_TOKEN=your_telegram_bot_token_here
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=vmeste_db
POSTGRES_PORT=5432
DEBUG=false
EOF

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã (PostgreSQL + Backend + Bot)
docker-compose up --build
```

## üìö API Endpoints

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| GET | `/health` | Health check |
| GET | `/api/v1/users/` | –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| POST | `/api/v1/users/` | –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| POST | `/api/v1/users/get-or-create` | –ü–æ–ª—É—á–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å |
| GET | `/api/v1/events/` | –°–ø–∏—Å–æ–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π |
| POST | `/api/v1/events/` | –°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ |
| POST | `/api/v1/events/{id}/participants/{user_id}` | –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è |
| DELETE | `/api/v1/events/{id}/participants/{user_id}` | –ü–æ–∫–∏–Ω—É—Ç—å |

## ü§ñ –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` ‚Äî –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- `/help` ‚Äî –°–ø—Ä–∞–≤–∫–∞

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### Backend

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `DATABASE_URL` | URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö | `sqlite+aiosqlite:///./app.db` (–ª–æ–∫–∞–ª—å–Ω–æ) –∏–ª–∏ `postgresql+asyncpg://...` (Docker) |
| `DEBUG` | –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ | `false` |
| `API_HOST` | –•–æ—Å—Ç API | `0.0.0.0` |
| `API_PORT` | –ü–æ—Ä—Ç API | `8000` |
| `ADMIN_USERNAME` | –õ–æ–≥–∏–Ω –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ | `admin` |
| `ADMIN_PASSWORD` | –ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ | `admin` |
| `ADMIN_SECRET_KEY` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è —Å–µ—Å—Å–∏–π | `change-me-in-production-secret-key-12345` |

### Bot

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ | ‚Äî |
| `API_BASE_URL` | URL Backend API | `http://backend:8000/api/v1` |
| `DEBUG` | –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ | `false` |

## üìù –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
cd backend

# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
uv run alembic revision --autogenerate -m "–æ–ø–∏—Å–∞–Ω–∏–µ"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
uv run alembic upgrade head
```

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# Backend
cd backend
uv sync --dev

# Bot
cd bot
uv sync --dev

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ pre-commit hooks (–≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞)
pre-commit install

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç
./.pre-commit-install.sh
```

### –õ–∏–Ω—Ç–∏–Ω–≥ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç [Ruff](https://github.com/astral-sh/ruff) –¥–ª—è –ª–∏–Ω—Ç–∏–Ω–≥–∞ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞.

**–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫:**

```bash
# Backend
cd backend
uv run ruff check .
uv run ruff format .

# Bot
cd bot
uv run ruff check .
uv run ruff format .
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ pre-commit:**

Pre-commit hooks –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ –∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç:
- –õ–∏–Ω—Ç–∏–Ω–≥ –∫–æ–¥–∞ (ruff check)
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (ruff format)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ YAML, JSON, TOML —Ñ–∞–π–ª–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ trailing whitespace
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å–ª–∏—è–Ω–∏—è

**–ó–∞–ø—É—Å–∫ pre-commit –≤—Ä—É—á–Ω—É—é:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã
pre-commit run --all-files

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
pre-commit run
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –∏ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Loguru:

- **–ö–æ–º–∞–Ω–¥—ã** (`/start`, `/help`, –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é) ‚Äî —É—Ä–æ–≤–µ–Ω—å `INFO`
  - –§–æ—Ä–º–∞—Ç: `üë§ /start –æ—Ç @username (id=123456)`
  - –§–æ—Ä–º–∞—Ç: `üë§ –ö–æ–º–∞–Ω–¥–∞ '–ú–æ–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏' –æ—Ç @username (id=123456)`
- **–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** ‚Äî —É—Ä–æ–≤–µ–Ω—å `DEBUG`
  - –§–æ—Ä–º–∞—Ç: `üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç @username (id=123456): —Ç–µ–∫—Å—Ç...`
- **–ú–µ–¥–∏–∞ —Ñ–∞–π–ª—ã** ‚Äî —É—Ä–æ–≤–µ–Ω—å `DEBUG`
  - –§–æ—Ä–º–∞—Ç: `üìé –ú–µ–¥–∏–∞ –æ—Ç @username (id=123456, type=photo)`
- **–û—à–∏–±–∫–∏** ‚Äî —É—Ä–æ–≤–µ–Ω—å `ERROR`

–õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å —Å —Ü–≤–µ—Ç–æ–≤–æ–π –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π. –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ (–ø—Ä–∏ `DEBUG=false`) –ª–æ–≥–∏ —Ç–∞–∫–∂–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ —Ñ–∞–π–ª—ã:
- `backend/logs/app.log`
- `bot/logs/bot.log`

**Middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ª–æ–≥–∏—Ä—É–µ—Ç –∏—Ö –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π handlers.

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
